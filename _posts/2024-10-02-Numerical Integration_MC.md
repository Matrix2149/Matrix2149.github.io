---
layout: post
title: "数值积分方法"
date: 2024-10-02 16:00:00 +0800
categories: [Science]
tags: [Numerics]  
comments: true
---

* Kramdown table of contents
{:toc .toc}

# 数值积分理论
数值积分的基本思想是将一定区间上的连续积分转化为离散求和，其形式如式（1），表现为函数值的加权和，$A_k$称为积分系数。当离散点的数量$n$充分大时，$I_n$将逼近准确的积分值。
$I(f)\equiv\int_a^bf\left(x\right)\mathrm{d}x\to I_n(f)\equiv\sum_{k=0}^nA_kf\left(x_k\right) \tag 1$
从上式可知，求数值积分的关键便是确定积分节点与积分系数。基于Newton-Cotes公式的等距节点插值和蒙特卡洛是两类基本的数值求积方法。c我们主要分析、比较这两类方法的特点和差异，以下是对这两类方法的理论介绍。

## Newton-Cotes公式求积
插值型求积是用拉格朗日插值法构造多项式函数近似被积函数，从而得到积分系数的一种数值积分方法。其求积公式为：
$I_n(f)=\sum_{k=0}^nf(x_k)\int_a^bl_k(x)\mathrm{d}x \tag2$
$l_k$是拉格朗日插值基函数。
当$x_k$取积分区间上的等距节点时，积分系数可以表示为：
$A_{k}=\int_{a}^{b}l_{k}(x)\mathrm{d}x=\int_{0}^{n}\prod_{j=0,j\neq k}^{n}(\frac{t-j}{k-j})\frac{b-a}n\mathrm{d}t \tag3$
将式（3）代入式（1），就可以得到n阶的Newton-Cotes公式。数学上可以证明n阶Newton-Cotes公式至少具有n次代数精度：

> 定理：当n是奇数时, Newton-Cotes公式至少具有n次代数精度。当n是偶数时, Newton-Cotes公式至少具有n+1次代数精度。


令

$C_{k}^{(n)}=\frac{1}{n}\int_{0}^{n}\prod_{j=0,j\neq k}^{n}\left(\frac{t-j}{k-j}\right){\mathrm{d}}t,\quad(k=0,1,2,\cdots,n) \tag4$

$C_{k}^{(n)}$称为Cotes系数。由于Cotes系数在7阶以上会出现负值，导致求积公式不稳定，故这一方法常用低阶形式。当n=1时可以得到梯形公式(trapezoidal rule)：
$I_1(f)=\frac{b-a}2\left(f(a)+f(b)\right) \tag5$

将梯形公式应用于积分区间中每个等分的小区间，可以得到复合梯形公式，即一般的数值积分梯形公式：
$T_n=h\left(\frac{f(a)+f(b)}2+\sum_{k=1}^{n-1}f(x_k)\right) \tag6$

其余项为
$R_n[f]=-\frac{(b-a)}{12}h^2f''(\eta),\quad\eta\in(a,b) \tag7$

当$n \to \infty$时，余项趋于0，故梯形公式是收敛的。
梯形公式的优点是简单易用，但当计算更高维度的积分时，其所需的积分点将会随维度呈指数增加，准确计算高维积分的开销很大。

## 蒙特卡洛求积
蒙特卡洛求积有均匀投点和随机抽样两种方法，我们探究的是后一种方法。不同于Newton-Cotes公式等间距取点，这里蒙特卡洛的基本思想是在积分区间内按一定概率密度$\rho(x)$随机取点，取出的点用以计算被积函数的样本均值：

$\hat{f}_{n}=\frac{1}{n}\sum_k^{n}f(x_k) \tag8$

根据大数定律，随着取样点的增多，样本均值将趋近于被积函数的实际均值:
$P\biggl(\lim_{n\to\infty}\frac{1}{n}\sum_{i=1}^{n}f\bigl(x_{i}\bigr)=\frac{I}{b-a}\biggr)=1 \tag9$

因而数值积分的计算公式可以写为：

$I_n=\int_{a}^{b}f\left(x\right)dx\approx\frac{b-a}{n}\sum_{i=0}^{n}f\left(x_{i}\right) \tag{10} $

蒙特卡洛方法本质是一种统计方法，因为式（8）样本均值的数学期望等于积分真值，所以它也是一种无偏估计。通常用方差定义其误差：

$\sigma_m^2=\left\langle M^2\right\rangle-\left\langle M\right\rangle^2 \tag{11} $

根据中心极限定理可以证明，蒙特卡洛积分无论维度，其误差正比于$n^{-1/2}$。对比式（1）不难发现，蒙特卡洛方法中积分系数已经确定仅与取样点数有关，而取样点的分布由其概率密度决定。如何缩减误差，选取不同分布的取样点有着显著作用。蒙特卡洛积分有重要采样(Important Sampling)与分层采样(Stratified Sampling)等缩减误差方法，我们这里分析前者的作用。

重要采样即让取样点主要落在对积分贡献较大的区间，从而通过较少的取样点便可准确估计积分值。

$I=\int\frac{f(x)}{p(x)}\cdot p(x)\mathrm{d}x=\int\frac{f(x)}{p(x)}\mathrm{d}\mathrm{P}(x)=\frac{1}{N}\sum_i\frac{f(x_i)}{p(x_i)} \tag{12} $

取样点分布的概率密度函数与被积函数形状越相似，一定取样点下的误差便越低。所以重要采样的前提也是需要知道一些关于被积函数的先验知识，从而选取较好的采样函数。

# 计算实验
## 积分函数
语言用Matlab, 积分和对应的采样函数是：
* Table 1

    |-----------------+------------+-----------------|
    |  |$\int_{0}^{1}x^{49}dx$| $\int_{0}^{1}\int_{0}^{1}(xy)^9dxdy$  |
    |-----------------|:-----------|:---------------:|
    | 采样函数① |$P(x)=x$   | $P(x)=x$     |
    | 采样函数②     |$P(x)=x^{10}$ | $P(x)=x^5$          |
    | 采样函数③      |$P(x)=x^{70}$ | $P(x)=x^{11}$            |
    |-----------------+------------+-----------------|



## 误差结果
### 一重积分

 {:style="text-align:center;"}
![](/images/Fig1.png){:height="600px" width="600px"}

可以看出采样函数对蒙特卡洛方法计算效率影响非常之大，当采样函数越能反映被积函数的特征时，积分的收敛速度与精度也越高。第三组蒙特卡洛方法在10个点以内便能将误差控制在1%以下，随着采样点数增加，另外两组的误差也不断下降，但三组积分之间的误差始终接近一个数量级。与梯形公式的对比也非常明显，10个点以内梯形公式的误差很大，但采样点数量增大后，其误差呈指数下降，远快于蒙特卡洛方法。

 {:style="text-align:center;"}
![](/images/Fig2.png){:height="600px" width="600px"}

上图显示了不同采样函数得到的采样点分布：第一组是均匀分布，故采样点与随机点重合；第二组的分布接近于被积函数较大的一边；第三组则更加集中在对积分有主要贡献的$x=1$左侧附近区间。对于$x^{49}$这样陡峭变化的函数，显然在[0,1]区间积分越靠近1的点越重要，重要采样对于积分效率的提升发挥了显著作用。
### 二重积分

 {:style="text-align:center;"}
![](/images/Fig3.png){:height="900px" width="900px"}

由于二重积分的计算速度较慢，我们计算的采样点相比一重积分要少得多。图6之所以梯形公式呈现L型，一是因为在采样点范围内，我们选取的样本有限，二也是梯形公式的收敛速度受维度所限。对于蒙特卡洛积分，重要采样的作用依然明显，更能反映被积函数变化趋势的第三组误差明显小于前两组，而第二组误差又明显小于均匀采样的第一组。对比梯形公式，蒙特卡洛积分的优势依然在采样点数较少时，用很少的采样点加以重要采样，便能得到比较准确的积分结果，但更多的采样点对计算精度的改观还不明显。相对一重积分，梯形公式计算明显出现了收敛速度下降，但随着采样点的增多，其收敛速度依然一定程度快于蒙特卡洛积分。

# 总结
数值积分方法的选取主要看积分的维度，二重以内的积分Newton-Cotes公式方法更快更准，而蒙特卡洛方法的收敛性不受维度影响，所以适用于二重以上的积分。蒙特卡洛的另一大优点是用比较少的采样点或者说计算量就能得到相对准确的估计值，所以对复杂积分，我们可以先用蒙卡简单测算一个大致的范围，再进行精确计算。